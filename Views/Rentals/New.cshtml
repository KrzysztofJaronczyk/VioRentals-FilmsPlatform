@model dynamic

@{
    ViewBag.Title = "New Rental Form";
}

<h2>New Rental Form</h2>



<div class="form-group">
    <label class="col-form-label mt-4">Search user</label>
    <input class="form-control" type="text" placeholder="Enter Client name or Surname" id="search-input">
    <div class="progress" id="search-progress">
        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>
    </div>
    <label class="col-form-label mt-4">Select user</label>
    <select class="form-select" id="search-results">
    </select>
</div>


<script>
    // debounce function
    function debounce(func, wait, immediate) {
        var timeout;
        return function () {
            var context = this, args = arguments;
            var later = function () {
                timeout = null;
                if (!immediate) func.apply(context, args);
            };
            var callNow = immediate && !timeout;
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
            if (callNow) func.apply(context, args);
        };
    };

    //search function
    var searchInput = document.getElementById("search-input");
    var searchResults = document.getElementById("search-results");
    var searchProgress = document.getElementById("search-progress");
    var progress = 0;
    searchInput.addEventListener("input", debounce(performSearch, 250));

    var intervalId;

    function performSearch() {
        
        //if thera are at least 3 characters in the search input
        if (searchInput.value.length >= 3) {
        progress = 0;
        clearInterval(intervalId);
        var searchTerm = searchInput.value;
        intervalId = setInterval(function () {
            progress += 10;
            if (progress >= 80) {
                clearInterval(intervalId);
                progress = 100;
                $.ajax({
                    type: "GET",
                    url: "/Customers/Search",
                    data: { searchTerm: searchTerm },
                    success: function (response) {
                        searchResults.innerHTML = "";
                        var option;
                        response.forEach(function (customer) {
                            option = document.createElement("option");
                            option.text = customer.name + " " + customer.surname + " Id: " + customer.id;
                            option.value = customer.id;
                            searchResults.add(option);
                        });
                    }
                });
            }
            var progressBar = searchProgress.querySelector(".progress-bar");
            progressBar.setAttribute("aria-valuenow", progress);
            progressBar.style.width = progress + "%";
        }, 500);
    }
    }
</script>

